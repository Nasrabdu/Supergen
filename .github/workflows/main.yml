- name: Materialize secrets to files
        shell: bash
        run: |
          set -e
          printf '%s' '${{ secrets.SESSIONS_JSON }}'     > sessions.json
          printf '%s' '${{ secrets.ALLOWED_IDS_JSON }}' > allowed_ids.json
          # فحوصات سريعة
          test -s sessions.json     || (echo "SESSIONS_JSON فارغ!" && exit 1)
          test -s allowed_ids.json  || (echo "ALLOWED_IDS_JSON فارغ!" && exit 1)
          echo "Files created:"; ls -l sessions.json allowed_ids.json

      - name: Run Telegram watcher
        env:
          TELEGRAM_API_ID:     ${{ secrets.API_ID }}          # <-- هنا التغيير
          TELEGRAM_API_HASH:   ${{ secrets.API_HASH }}        # <-- هنا التغيير
          TELEGRAM_BOT_TOKEN:  ${{ secrets.TELEGRAM_BOT_TOKEN }}
          SESS_FILE:           "sessions.json"
          ALLOWED_IDS_FILE:    "allowed_ids.json"
          DB_PATH:             "seen.db"
        shell: bash
        run: |
          set -e
          python telegram_watcher.py
